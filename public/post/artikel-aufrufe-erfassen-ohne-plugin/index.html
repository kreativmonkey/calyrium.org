<!DOCTYPE html>
<html lang="" class="no-js">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    
    <link rel="stylesheet" href="localhost/css/app.css">
    
    <link href="//fonts.googleapis.com/css?family=Questrial" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Sanchez:400italic,400" rel="stylesheet" type="text/css">
    <script src="js/vendor/modernizr-2.8.3.min.js"></script>
  </head>
  <body>
    
    <input id="togglenav" type="checkbox">
    <section id="header">
      <div id="mobile-nav">
        <label id="togglenav-lable" for="togglenav">Menu</label>
        <h1>Calyrium.org</h1>
      </div>
      <header>
        <div class="avatar">
          <image id="profile-img" src="localhost/img/profile.jpg" class="round"></image>
        </div>
        <div class="name">
          <h1>Calyrium.org</h1>
          <p>@Kreativmonkey</p>
          <ul class="social">
            <li><a href="javascript:void(0)"><img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/facebook-logo-circle.png" alt="Facebook"></a></li>
            <li><a href="javascript:void(0)"><img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/twitter-logo-circle.png" alt="Twitter"></a></li>
            <li><a href="javascript:void(0)"><img src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/youtube-logo-circle.png" alt="YouTube"></a></li>
          </ul>
        </div>
      </header>
      <nav role="navigation" id="main-nav">
        <ul class="navigation">
          <li> <a href="#" class="active">Blog  </a></li>
          <li> <a href="#">Portfolio</a></li>
          <li> <a href="#">Impressum</a></li>
        </ul>
      </nav>
    </section>

    <main>
      <article class="blog-article">
        <p class="type">post</p>
        <h1>Wordpress: Artikel aufrufe erfassen ohne plugin</h1>
        <p class="date">Jun 13, 2012</p>
        

<p>Aktuell habe ich versucht den Aufruf von Artikel ohne Plugins wie <a href="http://wordpress.org/extend/plugins/wp-postviews/" title="Link zum Plugin WP-PostViews">WP-PostViews</a> zu erfassen. Ich möchte die Artikelaufrufe zählen um in der Sidebar eine Liste der am häufigsten gelesenen Artikel ein zu fügen. Im folgenden habe ich mein Vorgehen erklärt.</p>

<p>Auf der Hilfreichen Webseite <a href="http://wpsnipp.com" title="Wordpress Code Snippets">WPsnipp.com</a> habe ich den entsprechenden Codeschnipsel gefunden den ich zum Zählen der Aufrufe benötige (<a href="http://wpsnipp.com/index.php/functions-php/track-post-views-without-a-plugin-using-post-meta/">Wordpress Track post views without a plugin using post meta</a>). Zum speichern der Anzahl nutze ich wie das Plugin die Benutzerdefinierten Felder wodurch ich ohne Probleme die Anzahl der aufrufe die bisher gezählt wurden übernehmen kann.</p>

<h2 id="zählen-der-artikelaufrufe:b69c920a2315af0eddb71bb9cc97f0d0">Zählen der Artikelaufrufe</h2>

<p>Der Folgende Code gehört in die functions.php deines Themes.</p>

<pre><code class="language-php">// Funktion zur anzeigen der Aufrufe im Theme
function getPostViews($postID){
    $count_key = 'post_views_count'; // Beim ersetzen des WP-PostView Plugin muss hier &quot;views&quot; stehen!
    $count = get_post_meta($postID, $count_key, true);
    if($count==''){
        delete_post_meta($postID, $count_key);
        add_post_meta($postID, $count_key, '0');
        return &quot;0 View&quot;;
    }
    return $count.' Views';
}
// Funktion zum Zaehlen der Aufrufe
function setPostViews($postID) {
    $count_key = 'post_views_count'; // Beim ersetzen des Plugin WP-PostViews muss hier &quot;views&quot; stehen!
    $count = get_post_meta($postID, $count_key, true);
    if($count==''){
        $count = 0;
        delete_post_meta($postID, $count_key);
        add_post_meta($postID, $count_key, '0');
    }else{
        $count++;
        update_post_meta($postID, $count_key, $count);
    }
}
</code></pre>

<p>Nun musst du noch in deiner single.php folgenden Code hinzufügen:</p>

<pre><code class="language-php">&lt;?php setPostViews(get_the_ID()); //Zaehlt die Aufrufe des Artikels ?&gt;
</code></pre>

<p>Um die Anzahl der Aufrufe in den Artikeln Anzuzeigen musst du an die gewünschte Stelle folgenden Code einfügen:</p>

<pre><code class="language-php">&lt;?php echo getPostViews(get_the_ID()); // Anzeige der Aufrufe im Theme  ?--&gt;
</code></pre>

<p>Nun werden die Aufrufe der Artikel gezählt. Möchtest du bestimmte Benutzergruppen von der Zählung ausschließen (z.B. die Administratoren) dann gelingt dir das mit Folgendem Code:</p>

<pre><code class="language-php">&lt;?php 
if ( ! current_user_can('administrator') ){ // Wenn der User nicht Administrator ist dann Zaehlen! 
    setPostViews(get_the_ID()); // Aufrufe Zaehlen  
}
?&gt;

</code></pre>

<h2 id="anzeige-der-meist-gelesenen-artikel:b69c920a2315af0eddb71bb9cc97f0d0">Anzeige der Meist gelesenen Artikel</h2>

<p>Zur Anzeige der meist gelesen Artikel bietet sich die Sidebar an, daher habe ich hier den Code für ein kleines aber nützliches Widget welches man über die Pluginverwaltung einspielt und aktiviert.</p>

<pre><code class="language-php">&lt;?php
/*
   Plugin Name: Last_Month_Most_Viewed_Posts
   Plugin URI: http://calyrium.org
   Description: Dieses Plugin erstellt ein Widget für die WordPress Sidebar
   Author: Sebastian Preisner
   Version: 1.1
   Author URI: http://calyrium.org
 */

function most_view_display_widget($args) {
    extract($args);

    $tage = '30';
    $artikel = '5';
    // Filterfunktion erstellen
    function filter_where( $where = '' ) {
        // Artikel der letzten 30 Tage (xx days koennen beliebig geaendert werden.)
        $where .= &quot; AND post_date &gt; '&quot; . date('Y-m-d', strtotime('-$tage days')) . &quot;'&quot;;
        return $where;
    }
    echo $before_widget;
    echo $before_title;?&gt;Top $artikel der letzten $tage Tage&lt;?php echo $after_title;
    echo &quot;&lt;ul&gt;&quot;;
    // Filter aktivieren
    add_filter( 'posts_where', 'filter_where' );
    // Abfrage starten
    $query = new WP_Query( array('showposts' =&gt; '$artikel', 'orderby' =&gt; 'meta_value_num', 'meta_key' =&gt; 'views', 'order' =&gt; 'DESC', 'category__not_in' =&gt; array(1799) ) );
    while ( $query-&gt;have_posts() ) : $query-&gt;the_post();
    $views = get_post_meta($post-&gt;ID, 'views');
    echo &quot;&lt;li&gt;&quot;;
    echo &quot;&lt;a href='&quot;; echo get_permalink(); echo &quot;'&gt;&quot;; echo get_the_title(); echo &quot;&lt;/a&gt;&quot;;
    echo &quot;&lt;/li&gt;&quot;;
    endwhile;
    echo &quot;&lt;/ul&gt;&quot;;
    echo $after_widget;
    // Filter deaktivieren (Wichtig!!)
    remove_filter( 'posts_where', 'filter_where' );

    /**
     * Sanitize widget form values as they are saved.
     *
     * @see WP_Widget::update()
     *
     * @param array $new_instance Values just sent to be saved.
     * @param array $old_instance Previously saved values from database.
     *
     * @return array Updated safe values to be saved.
     *
     public function update( $new_instance, $old_instance ) {
     $instance = array();
     $instance['title'] = strip_tags( $new_instance['title'] );
     $instance['number'] = strip_tags( $new_instance['number']);
     return $instance;
     }

    // Back-End Einstellungen
    public function form( $instance ) {
    if ( isset( $instance[ 'title' ] ) ) {
    $title = $instance[ 'title' ];
    }
    else {
    $title = __( 'New title', 'text_domain' );
    }
    if (isset( $instance[ 'number'] ) ) {
    $number = $instance[ 'number' ];
    }
    else {
    $number = '5';
    }
    ?&gt;
    &lt;p&gt;
    &lt;label for=&quot;&lt;?php echo $this-&gt;get_field_id( 'title' ); ?&gt;&quot;&gt;&lt;?php _e( 'Title:' ); ?&gt;&lt;/label&gt; 
    &lt;input class=&quot;widefat&quot; id=&quot;&lt;?php echo $this-&gt;get_field_id( 'title' ); ?&gt;&quot; name=&quot;&lt;?php echo $this-&gt;get_field_name( 'title' ); ?&gt;&quot; type=&quot;text&quot; value=&quot;&lt;?php echo esc_attr( $title ); ?&gt;&quot; /&gt;
    &lt;label for=&quot;&lt;?php echo $this-&gt;get_field_id( 'number' ); ?&gt;&quot;&gt;&lt;?php _e( 'Anzahl:' ); ?&gt;&lt;/label&gt;
    &lt;input class=&quot;widefat&quot; id=&quot;&lt;?php echo $this-&gt;get_field_id( 'number'); ?&gt;&quot; name=&quot;&lt;?php echo $this-&gt;get_field_name( 'nubmber'); ?&gt;&quot; type=&quot;text&quot; value=&quot;&lt;?php echo esc_attr( $number ); ?&gt;&quot; /&gt;
    &lt;/p&gt;
    &lt;?php 

    } */
}
wp_register_sidebar_widget(
        'mostview_lastmonth_1',        // your unique widget id
        'Most view last month',          // widget name
        'most_view_display_widget',  // callback function
        array(                  // options
            'description' =&gt; 'Zeigt die am häufigsten aufgerufenen Artikel des letzten Monats'
            )
        );
</code></pre>

        <ul class="taglist">
          <li>Test </li>
          <li>Article</li>
          <li>WordPresss</li>
        </ul>
        <hr>
        <p class="author">Author Name</p>
      </article>
    </main>




<footer role="contentinfo" class="footer-2">
  <ul>
    <li><a href="javascript:void(0)">About</a></li>
    <li><a href="javascript:void(0)">Contact</a></li>
  </ul>
  <div class="footer-secondary-links">
    <ul>
      <li><a href="javascript:void(0)">Impressum und Disclaimer</a></li>
      <li><a href="javascript:void(0)">Datenschutz</a></li>
    </ul>
  </div>
</footer>
</body>
<script src="js/dist.js"></script>
</html>

